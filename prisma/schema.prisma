generator client {
  provider = "prisma-client-js"

  previewFeatures = ["relationJoins"]
}

datasource db {
  provider = "sqlite"
  url      = "file:../database/db.db"
}

model User {
  id        Int     @id @default(autoincrement())
  firstName String?
  lastName  String?
  email     String  @unique
  password  String

  session      Session[]
  role         Role           @relation(fields: [roleId], references: [id])
  roleId       Int
  image        Image          @relation(fields: [imageId], references: [id])
  imageId      Int
  Course       Course[]
  CourseRating CourseRating[]
}

model Image {
  id        Int      @id @default(autoincrement())
  url       String
  createdAt DateTime @default(now())

  bucketImageId String   @unique
  User          User[]
  Video         Video[]
  Course        Course[]
}

model Session {
  id           Int      @id @default(autoincrement())
  refreshToken String   @unique
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  userId Int
  user   User @relation(fields: [userId], references: [id])
}

model Role {
  id   Int    @id @default(autoincrement())
  name String @unique

  users User[]
}

model Video {
  id            Int    @id @default(autoincrement())
  url           String
  lengthSec     Int
  name          String
  description   String
  index         Int
  bucketVideoId String @unique

  thumbnailId Int
  thumbnail   Image  @relation(fields: [thumbnailId], references: [id])
  courseId    Int
  Course      Course @relation(fields: [courseId], references: [id])
}

model Category {
  id   Int    @id @default(autoincrement())
  name String @unique

  courseCategory CourseCategory[]
}

model CourseCategory {
  id         Int @id @default(autoincrement())
  categoryId Int
  courseId   Int

  category Category @relation(fields: [categoryId], references: [id])
  course   Course   @relation(fields: [courseId], references: [id])

  @@unique([categoryId, courseId])
}

model Course {
  id          Int      @id @default(autoincrement())
  name        String
  description String
  createdAt   DateTime @default(now())

  videos       Video[]
  thumbnail    Image            @relation(fields: [thumbnailId], references: [id])
  thumbnailId  Int
  user         User             @relation(fields: [userId], references: [id])
  userId       Int
  categories   CourseCategory[]
  price        Float
  CourseRating CourseRating[]
}

model CourseRating {
  id     Int @id @default(autoincrement())
  rating Int

  user     User   @relation(fields: [userId], references: [id])
  userId   Int
  course   Course @relation(fields: [courseId], references: [id])
  courseId Int
}
